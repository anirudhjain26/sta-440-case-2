---
title: "STA 440 Case 2"
author: "Krish Bansal, Lily Seelig, Anirudh Jain"
# format: pdf
format: 
  pdf:
    documentclass: article 
    fontsize: 11pt         
    classoption: oneside       
editor: visual
geometry: margin=1in
title-block-spacing: compact
execute: 
  echo: false
  warning: false
  message: false
---

```{r, message=FALSE}
# imports
library(readr)
library(tidyverse)
library(patchwork)
library(scales)
library(ggplot2)
library(dplyr)
library(tidyr)
library(stringr)
```

# Introduction

# Data

```{r, message=FALSE}

raw <- read_csv("data/JO2.csv", col_names = FALSE, show_col_types = FALSE)

header1 <- as.character(unlist(raw[1, ]))  # substrates in row 1
header2 <- as.character(unlist(raw[2, ]))  # doses in row 2

sub <- header1
sub[1] <- "Subject"
for (i in 2:length(sub)) {
  if (is.na(sub[i]) || sub[i] == "") sub[i] <- sub[i - 1]
}

dose <- header2
dose[1] <- NA  # first col is Subject

new_names <- c("Subject", paste(sub[-1], dose[-1], sep = "_"))

dat <- raw[-c(1, 2), ]
names(dat) <- new_names
dat <- dat %>% mutate(across(-Subject, ~ suppressWarnings(as.numeric(.))))

data_long <- dat %>%
  pivot_longer(
    cols = -Subject,
    names_to = c("Substrate", "Dose"),
    names_sep = "_",
    values_to = "JO2"
  ) %>%
  mutate(
    Genotype = if_else(str_detect(Subject, "^NT"), "NT", "Tg"),
    # keep Basal as a category; make numeric where applicable
    Dose_num = suppressWarnings(as.numeric(Dose)),
    Dose = factor(Dose,
                  levels = c("Basal", "-12.95","-13.65","-13.95","-14.19","-14.36","-14.49"),
                  ordered = TRUE)
  ) %>%
  drop_na(JO2)   

```

```{r}
glimpse(data_long)
```

# Exploratory Data Analysis

```{r}
#| label: histogram 

#raw
hist(data_long$JO2, breaks=60, main="JO2 (raw)")

#log10
hist(log10(data_long$JO2), breaks=60, main="log10(JO2)")

```

```{r}
#| label: dose-response-by-substrate

ggplot(df |> filter(!is_basal), aes(x=Dose, y=log(JO2), group=MouseID, color=Genotype)) +
  geom_line(alpha=0.3) +
  geom_point() +
  facet_wrap(~Substrate, scales="free_x") +
  stat_summary(aes(group=Genotype), fun.data=mean_cl_boot, geom="errorbar", width=0.05, color="black")


```

# Model

# Results

# Conclusion

# Limitations and Future Work

\newpage

# Appendix
